<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="Giardino">
    <link rel="apple-touch-icon" href="icon-192x192.png">
    <link rel="apple-touch-icon" sizes="512x512" href="icon-512x512.png">
    <link rel="manifest" href="manifest.json">
    <title>Giardino Digitale</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<body>
    <div id="loading-spinner" class="loading-spinner hidden"></div>

    <header class="main-header">
        <h1>Giardino Digitale</h1>
        <div class="header-controls">
            <span id="auth-status" class="auth-status">Non loggato</span>
            <div class="auth-buttons">
                <button id="loginButton" class="btn">Login</button>
                <button id="registerButton" class="btn">Registrati</button>
                <button id="logoutButton" class="btn hidden">Logout</button>
            </div>
        </div>
    </header>

    <main class="main-content">
        <section id="authContainer" class="auth-section">
            <div class="auth-forms">
                <div id="loginForm" class="auth-form-card">
                    <h2>Login</h2>
                    <input type="email" id="loginEmail" placeholder="Email" required>
                    <input type="password" id="loginPassword" placeholder="Password" required>
                    <button type="submit" class="btn" form="loginForm">Accedi</button>
                    <p class="error-message" id="loginError"></p>
                    <p>Non hai un account? <a href="#" id="showRegister">Registrati qui</a></p>
                </div>

                <div id="registerForm" class="auth-form-card hidden">
                    <h2>Registrati</h2>
                    <input type="email" id="registerEmail" placeholder="Email" required>
                    <input type="password" id="registerPassword" placeholder="Password" required>
                    <button type="submit" class="btn" form="registerForm">Registrati</button>
                    <p class="error-message" id="registerError"></p>
                    <p>Hai già un account? <a href="#" id="showLogin">Accedi qui</a></p>
                </div>
            </div>
        </section>

        <section id="appContent" class="app-content hidden">
            <div class="controls-container">
                <div class="filter-sort-group">
                    <input type="text" id="searchInput" placeholder="Cerca piante..." class="control-input">
                    <select id="categoryFilter" class="control-select">
                        <option value="all">Tutte le Categorie</option>
                        <option value="interna">Interna</option>
                        <option value="esterna">Esterna</option>
                        <option value="aromatica">Aromatica</option>
                        <option value="fiore">Fiore</option>
                        <option value="succulenta">Succulenta</option>
                        </select>
                    <div class="temp-filter-group">
                        <input type="number" id="tempMinFilter" placeholder="Temp Min (°C)" class="control-input temp-input">
                        <span>-</span>
                        <input type="number" id="tempMaxFilter" placeholder="Temp Max (°C)" class="control-input temp-input">
                    </div>
                    <select id="sortBy" class="control-select">
                        <option value="name_asc">Nome (A-Z)</option>
                        <option value="name_desc">Nome (Z-A)</option>
                        <option value="added_asc">Aggiunta (Asc)</option>
                        <option value="added_desc">Aggiunta (Desc)</option>
                    </select>
                </div>
                <div class="action-buttons-group">
                    <button id="showAllPlantsButton" class="btn active">Tutte le Piante</button>
                    <button id="showMyGardenButton" class="btn">Mio Giardino</button>
                    <button id="addNewPlantButton" class="btn">Aggiungi Nuova Pianta</button>
                </div>
                <div id="lightSensorContainer" class="light-sensor-container">
                    <p>Luce Ambientale: <span id="currentLuxValue">N/A</span></p>
                    <button id="startLightSensorButton" class="btn">Avvia Sensore Luce</button>
                    <button id="stopLightSensorButton" class="btn hidden">Ferma Sensore Luce</button>
                    <p id="lightFeedback"></p>
                    <button id="googleLensButton" class="btn">
                        <i class="fas fa-camera"></i> Google Lens
                    </button>
                </div>
            </div>

            <h2 id="plantsSectionHeader">Tutte le Piante Disponibili</h2>
            <div id="gardenContainer" class="garden-grid">
                </div>
            <div id="myGardenContainer" class="garden-grid hidden">
                </div>
        </section>
    </main>

    <footer class="main-footer">
        <p>&copy; 2023 Giardino Digitale. Tutti i diritti riservati.</p>
    </footer>

    <button id="scrollToTopButton" class="scroll-to-top-button hidden" title="Torna su">
        <i class="fas fa-arrow-up"></i>
    </button>

    <div id="addPlantModal" class="modal">
        <div class="modal-content plant-form-card">
            <span class="close-button" id="closeAddPlantModal">&times;</span>
            <h2>Aggiungi/Modifica Pianta</h2>
            <form id="plantForm">
                <div class="form-group">
                    <label for="plantImage">Immagine Pianta</label>
                    <input type="file" id="plantImage" accept="image/*">
                    <img id="imagePreview" src="#" alt="Anteprima Immagine" style="display:none; max-width:100px; max-height:100px; margin-top:10px;">
                </div>
                <div class="form-group">
                    <label for="plantName">Nome Pianta</label>
                    <input type="text" id="plantName" required>
                </div>
                <div class="form-group">
                    <label for="plantCategory">Categoria</label>
                    <select id="plantCategory" required>
                        <option value="">Seleziona Categoria</option>
                        <option value="interna">Interna</option>
                        <option value="esterna">Esterna</option>
                        <option value="aromatica">Aromatica</option>
                        <option value="fiore">Fiore</option>
                        <option value="succulenta">Succulenta</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="plantDescription">Descrizione</label>
                    <textarea id="plantDescription" rows="4"></textarea>
                </div>
                <div class="form-group temp-input-group">
                    <label>Temperatura Ideale (°C)</label>
                    <input type="number" id="plantTempMin" placeholder="Min">
                    <span>-</span>
                    <input type="number" id="plantTempMax" placeholder="Max">
                </div>
                <div class="form-group lux-input-group">
                    <label>Luce Ideale (Lux)</label>
                    <input type="number" id="plantLightMin" placeholder="Min Lux">
                    <span>-</span>
                    <input type="number" id="plantLightMax" placeholder="Max Lux">
                </div>

                <div class="form-actions">
                    <button type="submit" id="saveUpdatePlantButton">Salva Modifiche</button>
                    <button type="button" id="cancelUpdatePlantButton" class="cancel-button">Annulla</button>
                    <button type="button" id="deletePlant" class="delete-button">Elimina Pianta dal Database</button>
                </div>
            </form>
        </div>
    </div>

    <div id="cardModal" class="modal">
        <div class="modal-content card-details-modal-content">
            <span class="close-button" id="closeCardModal">&times;</span>
            <div id="zoomedCardContent">
                </div>
        </div>
    </div>

    <div id="imageZoomModal" class="modal">
        <div class="modal-content image-zoom-content">
            <span class="close-button" id="closeImageModalButton">&times;</span>
            <img id="zoomedCardImage" src="" alt="Immagine Ingrandita">
        </div>
    </div>

    <div id="toast" class="toast"></div>

    <script type="module">
        // Importa le funzioni necessarie dai moduli Firebase
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js';
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/10.11.0/firebase-auth.js';
        import { getFirestore, collection, getDocs, doc, addDoc, updateDoc, deleteDoc, query, where } from 'https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js';
        import { getStorage, ref as storageRef, uploadBytesResumable, getDownloadURL, deleteObject } from 'https://www.gstatic.com/firebasejs/10.11.0/firebase-storage.js';


        // Configura Firebase - SOSTITUISCI CON I TUOI DATI!
        const firebaseConfig = {
              apiKey: "AIzaSyAo8HU5vNNm_H-HvxeDa7xSsg3IEmdlE_4",
              authDomain: "giardinodigitale.firebaseapp.com",
              projectId: "giardinodigitale",
              storageBucket: "giardinodigitale.appspot.com", // Assicurati che questo sia corretto per il tuo progetto
              messagingSenderId: "96265504000",
              appId: "1:96265504000:web:12b7a9f9c0c0c0c0c0c0c0"
        };

        // Inizializza Firebase
        const app = initializeApp(firebaseConfig);

        // Espone i servizi Firebase al global scope (window) per app.js
        window.auth = getAuth(app);
        window.db = getFirestore(app);
        window.storage = getStorage(app);

        // Espone le funzioni modulari necessarie a app.js
        window.signInWithEmailAndPassword = signInWithEmailAndPassword;
        window.createUserWithEmailAndPassword = createUserWithEmailAndPassword;
        window.onAuthStateChanged = onAuthStateChanged;
        window.signOut = signOut;

        window.collection = collection;
        window.getDocs = getDocs;
        window.doc = doc;
        window.addDoc = addDoc;
        window.updateDoc = updateDoc;
        window.deleteDoc = deleteDoc;
        window.query = query;
        window.where = where;

        window.getStorageRef = storageRef; // Rinomina 'ref' in 'storageRef' per evitare conflitti e chiarezza
        window.uploadBytesResumable = uploadBytesResumable;
        window.getDownloadURL = getDownloadURL;
        window.deleteObject = deleteObject; // Per eliminare file da Storage
    </script>
    <script src="app.js"></script>
</body>
</html>
