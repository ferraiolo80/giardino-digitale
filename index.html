<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="Giardino">
    <link rel="apple-touch-icon" href="icon-192x192.png">
    <link rel="apple-touch-icon" sizes="512x512" href="icon-512x512.png">
    <link rel="manifest" href="manifest.json">
    <title>Giardino Digitale</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6TaYFAaCfkfka5xSgCgKqS9jRSPJweYjFDXVPYk4fdXADwng==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<body>
    <div id="loading-spinner" class="loading-spinner">
        <div class="spinner"></div>
    </div>

    <header>
        <div id="auth-status"></div>
        <h1>Giardino Digitale</h1>
        <div>
            <button id="logoutButton" class="hidden">Logout</button>
        </div>
    </header>

    <div id="app-content">
        <div id="authContainer" class="auth-container">
            <h2>Accedi o Registrati</h2>
            <form id="loginForm">
                <label for="emailInput">Email:</label>
                <input type="email" id="emailInput" placeholder="Email" required>
                <label for="passwordInput">Password:</label>
                <input type="password" id="passwordInput" placeholder="Password" required>
                <button type="submit" id="loginButton">Login</button>
                <p class="error-message" id="loginError"></p>
                <p>Non hai un account? <a href="#" id="showRegisterLink">Registrati qui</a></p>
            </form>

            <form id="registerForm" class="hidden">
                <h2>Registrati</h2>
                <label for="registerEmailInput">Email:</label>
                <input type="email" id="registerEmailInput" placeholder="Email" required>
                <label for="registerPasswordInput">Password:</label>
                <input type="password" id="registerPasswordInput" placeholder="Password" required>
                <button type="submit" id="registerButton">Registrati</button>
                <p class="error-message" id="registerError"></p>
                <p>Hai già un account? <a href="#" id="showLoginLink">Accedi qui</a></p>
            </form>
        </div>

        <div id="mainAppContent" class="hidden">

            <div class="main-buttons-container">
                <button id="addNewPlantButton"><i class="fas fa-plus-circle"></i> Aggiungi Nuova Pianta</button>
                <button id="showAllPlantsButton"><i class="fas fa-leaf"></i> Tutte le Piante</button>
                <button id="showMyGardenButton"><i class="fas fa-seedling"></i> Mio Giardino</button>
            </div>

            <div class="search-filter-sort-container">
                <div>
                    <i class="fas fa-search"></i>
                    <input type="text" id="searchInput" placeholder="Cerca pianta...">
                </div>
                <div>
                    <i class="fas fa-tag"></i>
                    <select id="categoryFilter">
                        <option value="">Tutte le Categorie</option>
                        <option value="Frutta">Frutta</option>
                        <option value="Verdura">Verdura</option>
                        <option value="Erbe Aromatiche">Erbe Aromatiche</option>
                        <option value="Fiori">Fiori</option>
                        <option value="Arbusti">Arbusti</option>
                        <option value="Alberi">Alberi</option>
                        <option value="Succulente">Succulente</option>
                        <option value="Altro">Altro</option>
                    </select>
                </div>
                <div class="temp-filter-container">
                    <i class="fas fa-temperature-three-quarters"></i>
                    <input type="number" id="tempMinFilter" placeholder="Min Temp °C">
                    <span> - </span>
                    <input type="number" id="tempMaxFilter" placeholder="Max Temp °C">
                </div>
                <div>
                    <i class="fas fa-sort"></i>
                    <select id="sortBySelect">
                        <option value="name_asc">Nome (A-Z)</option>
                        <option value="name_desc">Nome (Z-A)</option>
                        <option value="category_asc">Categoria (A-Z)</option>
                        <option value="category_desc">Categoria (Z-A)</option>
                    </select>
                </div>
            </div>

            <div class="geolocation-section">
                <h2><i class="fas fa-map-marker-alt"></i> La Tua Posizione</h2>
                <button id="getLocationButton" class="action-button">Ottieni Posizione</button>
                <div id="locationStatus" class="status-message hidden"><i class="fas fa-info-circle"></i> In attesa della posizione...</div>
                <div id="locationDisplay" class="status-message hidden"></div>

                <div id="weatherForecast" class="weather-forecast hidden">
                    <h4><i class="fas fa-cloud-sun-rain"></i> Previsioni Meteo</h4>
                    <p id="weatherLocation"></p>
                    <p id="weatherDescription"></p>
                    <p id="weatherTemperature"></p>
                    <p id="weatherHumidity"></p>
                    <p id="weatherWind"></p>
                    <p class="error-message" id="weatherError"></p>
                </div>
            </div>

            <div class="light-sensor-container">
                <h2><i class="fas fa-sun"></i> Sensore di Luce Ambientale</h2>
                <div class="sensor-info-row">
                    <div class="sensor-controls">
                        <button id="startLightSensorButton"><i class="fas fa-play-circle"></i> Avvia Sensore</button>
                        <button id="stopLightSensorButton" class="cancel-button"><i class="fas fa-stop-circle"></i> Ferma Sensore</button>
                    </div>
                    <div>
                        <p>Lux Attuali: <span id="currentLuxValue">N/A</span></p>
                    </div>
                </div>
                <div id="lightFeedback">
                    <p>Avvia il sensore per ottenere la lettura della luce ambientale.</p>
                </div>
            </div>

            <h2 id="plantsSectionHeader" style="text-align: center; margin-top: 30px; color: #2e7d32;">Tutte le Piante Disponibili</h2>

            <div id="garden-container">
                </div>

            <div id="my-garden" class="hidden">
                <div id="empty-garden-message" class="hidden">
                    <p>Il tuo giardino è vuoto. Aggiungi alcune piante!</p>
                </div>
            </div>

        </div> </div> <div id="plantFormModal" class="modal">
        <div class="plant-form-card">
            <span class="close-button" id="closePlantFormModalButton">&times;</span>
            <h2 id="plantFormTitle">Aggiungi Nuova Pianta</h2>
            <form id="plantForm">
                <label for="plantName">Nome Comune:</label>
                <input type="text" id="plantName" placeholder="Es: Basilico" required>
                <p class="error-message" id="nameError"></p>

                <label for="scientificName">Nome Scientifico (Opzionale):</label>
                <input type="text" id="scientificName" placeholder="Es: Ocimum basilicum">

                <label for="plantCategory">Categoria:</label>
                <select id="plantCategory" required>
                    <option value="">Seleziona Categoria</option>
                    <option value="Frutta">Frutta</option>
                    <option value="Verdura">Verdura</option>
                    <option value="Erbe Aromatiche">Erbe Aromatiche</option>
                    <option value="Fiori">Fiori</option>
                    <option value="Arbusti">Arbusti</option>
                    <option value="Alberi">Alberi</option>
                    <option value="Succulente">Succulente</option>
                    <option value="Altro">Altro</option>
                </select>
                <p class="error-message" id="categoryError"></p>

                <label for="wateringFrequency">Frequenza Irrigazione (giorni):</label>
                <input type="number" id="wateringFrequency" placeholder="Es: 3" min="1">
                <p class="error-message" id="wateringError"></p>

                <label for="sunlightNeeds">Esigenze di Luce:</label>
                <select id="sunlightNeeds">
                    <option value="">Seleziona Esigenza</option>
                    <option value="Pieno Sole">Pieno Sole</option>
                    <option value="Mezz'ombra">Mezz'ombra</option>
                    <option value="Ombra">Ombra</option>
                </select>

                <div class="lux-input-group">
                    <label for="luxMin">Lux Minima:</label>
                    <input type="number" id="luxMin" placeholder="Es: 1000">
                    <label for="luxMax">Lux Massima:</label>
                    <input type="number" id="luxMax" placeholder="Es: 5000">
                </div>

                <div class="temp-input-group">
                    <label for="tempMin">Temperatura Minima (°C):</label>
                    <input type="number" id="tempMin" placeholder="Es: 15">
                    <label for="tempMax">Temperatura Massima (°C):</label>
                    <input type="number" id="tempMax" placeholder="Es: 30">
                </div>

                <label for="plantDescription">Descrizione:</label>
                <textarea id="plantDescription" placeholder="Breve descrizione della pianta..."></textarea>

                <label for="plantImage">Immagine Pianta:</label>
                <input type="file" id="plantImage" accept="image/*">
                <p class="error-message" id="imageError"></p>

                <img id="imagePreview" src="#" alt="Anteprima Immagine" style="max-width: 100%; height: auto; margin-top: 10px; display: none;">

                <div class="form-actions">
                    <button type="submit" id="saveUpdatePlantButton">Salva Modifiche</button>
                    <button type="button" id="cancelUpdatePlantButton" class="cancel-button">Annulla</button>
                    <button type="button" id="deletePlant" class="delete-button hidden">Elimina Pianta dal Database</button>
                </div>
            </form>
        </div>
    </div>


    <div id="imageModal" class="modal">
        <span class="close-button" id="closeImageModalButton">&times;</span>
        <img class="modal-content" id="zoomedImage">
    </div>

    <div id="cardModal" class="modal">
        <span class="close-button" id="closeCardModalButton">&times;</span>
        <div class="modal-content" id="zoomedCardContent">
            </div>
    </div>

    <div id="toastContainer" class="toast-container"></div>


    <script type="module">
        // Importa le funzioni necessarie dagli SDK
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
        import { getAuth } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-auth.js";
        import { getFirestore } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js";
        import { getStorage } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-storage.js";

        // Configura Firebase - SOSTITUISCI CON I TUOI DATI SE NECESSARIO!
        const firebaseConfig = {
              apiKey: "AIzaSyAo8HU5vNNm_H-HvxeDa7xSsg3IEmdlE_4",
              authDomain: "giardinodigitale.firebaseapp.com",
              projectId: "giardinodigitale",
              storageBucket: "giardinodigitale.firebasestorage.app",
              messagingSenderId: "96265504027",
              appId: "1:96265504027:web:903c3df92cfa24beb17fbe"
        };

        // Inizializza Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const storage = getStorage(app);

        // Rendi le istanze Firebase disponibili globalmente per app.js
        window.auth = auth;
        window.db = db;
        window.storage = storage;
    </script>
    <script src="app.js"></script>
</body>
</html>
